<UserControl xmlns:LogItems="clr-namespace:ZhApi.WpfApp.LogItems"  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"  x:Class="ZhApi.WpfApp.MainControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:ZhApi.WpfApp"
             mc:Ignorable="d"
             Background="#272727"
             Foreground="{DynamicResource TextE6}"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             Loaded="UserControl_Loaded"
             d:Height="360" d:Width="700" >

    <d:UserControl.DataContext>
        <local:MainControlViewModel
            ButtonsVisibility="Visible"
            />
    </d:UserControl.DataContext>

    <UserControl.Resources>

        <Style x:Key="buttonIcon" TargetType="TextBlock" >
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="FontFamily" Value="{StaticResource SymbolThemeFontFamily}"/>
            <Setter Property="FontSize" Value="50"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>

        <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
            <Setter Property="Visibility" Value="{Binding ButtonsVisibility}"/>
            <Setter Property="IsEnabled" Value="{Binding IsEnabled}"/>
            <Setter Property="AllowDrop" Value="True"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="5"/>
        </Style>

        <Style TargetType="CheckBox"  BasedOn="{StaticResource {x:Type CheckBox}}">
            <Setter Property="Visibility" Value="{Binding ButtonsVisibility}"/>
            <Setter Property="IsEnabled" Value="{Binding IsEnabled}"/>
        </Style>

        <Style TargetType="TextBlock" x:Key="title">
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>

    </UserControl.Resources>

    <Grid Margin="80,10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition/>
            <ColumnDefinition/>
            <ColumnDefinition/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition/>
            <RowDefinition/>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <!-- 文档翻译 -->
        <Button
            Grid.Column="0" Grid.Row="1">
            <StackPanel>
                <TextBlock Text="&#xE768;" Style="{StaticResource buttonIcon}"/>
                <TextBlock Text="执行翻译" Style="{StaticResource title}"/>
            </StackPanel>
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Click">
                    <i:InvokeCommandAction
                        Command="{Binding TranslateClickCommand}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="Drop">
                    <i:InvokeCommandAction
                        Command="{Binding TranslateDropCommand}"
                        PassEventArgsToCommand="True"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </Button>

        <!-- 同步数据库 -->
        <Button Grid.Column="1" Grid.Row="1">
            <StackPanel>
                <TextBlock Text="&#xEDAB;" Style="{StaticResource buttonIcon}"/>
                <TextBlock Text="数据库同步" Style="{StaticResource title}"/>
            </StackPanel>
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Click">
                    <i:InvokeCommandAction
                        Command="{Binding SyncDataBaseClickCommand}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="Drop">
                    <i:InvokeCommandAction
                        Command="{Binding SyncDataBaseDropCommand}"
                        PassEventArgsToCommand="True"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </Button>

        <!-- 修复 -->
        <Button Grid.Column="2" Grid.Row="1" AllowDrop ="False" >
            <StackPanel>
                <TextBlock Text="&#xE783;" Style="{StaticResource buttonIcon}"/>
                <TextBlock Text="{Binding RepairTitle,StringFormat='修复{0}'}"
                           Style="{StaticResource title}"/>
            </StackPanel>
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Click">
                    <i:InvokeCommandAction
                        Command="{Binding RepairClickCommand}"/>
                </i:EventTrigger>

            </i:Interaction.Triggers>
        </Button>

        <!-- 导入 -->
        <Button Grid.Column="4" Grid.Row="1">
            <StackPanel>
                <TextBlock Text="&#xE8F7;" Style="{StaticResource buttonIcon}"/>
                <TextBlock Text="导入XML" Style="{StaticResource title}"/>
            </StackPanel>
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Click">
                    <i:InvokeCommandAction
                        Command="{Binding ImportXmlClickCommand}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="Drop">
                    <i:InvokeCommandAction
                        Command="{Binding ImportXmlDropCommand}"
                        PassEventArgsToCommand="True"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </Button>

        <!-- 加载进度 -->
        <StackPanel
            Visibility="{Binding ButtonsVisibility,Converter={StaticResource notVisibility}}"
            VerticalAlignment="Center"
            Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2">
            <ProgressBar Width="50" IsIndeterminate="True"/>
            <TextBlock Text="初始化中" HorizontalAlignment="Center"/>
        </StackPanel>


        <LogItems:VersionControl
            Grid.Row="2" Grid.ColumnSpan="4"
            VerticalAlignment="Bottom"
            HorizontalAlignment="Center"
            DataContext="{Binding Version}"/>


        <StackPanel
            Grid.Row="2"
            VerticalAlignment="Top"
            Margin="0,10,0,0"
            HorizontalAlignment="Center">
            <CheckBox
                Width="auto"
                Content="启用覆盖"
                IsChecked="{Binding RunConfig.IsCover}">
            </CheckBox>

            <CheckBox
                Width="auto"
                Content="跳过模型"
                IsChecked="{Binding RunConfig.StopModel}">
            </CheckBox>
            <StackPanel.RenderTransform>
                <ScaleTransform ScaleX="0.8" ScaleY="0.8" CenterX="50"/>
            </StackPanel.RenderTransform>
        </StackPanel>


        <Button
            Grid.Row="2"
            Grid.Column="2"
            VerticalAlignment="Top"
            Margin="0,10,0,0"
            HorizontalAlignment="Center"
            Width="auto"
            Command="{Binding ResetRepairCommand}"
            Content="重置">
            <Button.RenderTransform>
                <ScaleTransform ScaleX="0.8" ScaleY="0.8" CenterX="50"/>
            </Button.RenderTransform>
        </Button>
    </Grid>

</UserControl>
